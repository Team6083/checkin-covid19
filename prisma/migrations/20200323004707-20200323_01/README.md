# Migration `20200323004707-20200323_01`

This migration has been generated by KennHuang at 3/23/2020, 12:47:07 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "quaint"."User.userNumber"

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_User" (
    "cardUUID" TEXT NOT NULL DEFAULT '' ,
    "name" TEXT NOT NULL DEFAULT '' ,
    "studentNumber" TEXT NOT NULL  ,
    PRIMARY KEY ("studentNumber")
) 

INSERT INTO "quaint"."new_User" ("cardUUID", "name") SELECT "cardUUID", "name" FROM "quaint"."User"

DROP TABLE "quaint"."User";

ALTER TABLE "quaint"."new_User" RENAME TO "User";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_CheckinLog" (
    "checkinAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "id" INTEGER NOT NULL  ,
    "temperature" REAL NOT NULL DEFAULT 0 ,
    "user" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("user") REFERENCES "User"("studentNumber") ON DELETE CASCADE ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_CheckinLog" ("checkinAt", "id", "temperature", "user") SELECT "checkinAt", "id", "temperature", "user" FROM "quaint"."CheckinLog"

DROP TABLE "quaint"."CheckinLog";

ALTER TABLE "quaint"."new_CheckinLog" RENAME TO "CheckinLog";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200323000720-init..20200323004707-20200323_01
--- datamodel.dml
+++ datamodel.dml
@@ -1,24 +1,23 @@
 datasource sqlite {
-  url = "***"
+  url      = "file:data.db"
   provider = "sqlite"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id          Int          @id
-  userNumber  String       @unique
-  cardUUID    String
-  name        String
-  checkinLogs CheckinLog[]
+  studentNumber String       @id
+  cardUUID      String
+  name          String
+  checkinLogs   CheckinLog[]
 }
 model CheckinLog {
   id          Int      @id
-  user        User     @relation(references: [id])
+  user        User     @relation(references: [studentNumber])
   checkinAt   DateTime
   temperature Float
 }
```


