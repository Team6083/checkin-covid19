# Migration `20200323162554-change-token-jti-from-int-to-string`

This migration has been generated by KennHuang at 3/23/2020, 4:25:54 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP TABLE `checkin-covid19`.`AdminAccounts`,`checkin-covid19`.`CheckinLog`,`checkin-covid19`.`Token`,`checkin-covid19`.`User`;

CREATE TABLE `checkin-covid19`.`User` (
    `cardUUID` varchar(191)   ,
    `name` varchar(191) NOT NULL DEFAULT '' ,
    `studentNumber` varchar(191) NOT NULL  ,
    PRIMARY KEY (`studentNumber`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `checkin-covid19`.`CheckinLog` (
    `checkinAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    `id` int NOT NULL  AUTO_INCREMENT,
    `temperature` Decimal(65,30) NOT NULL DEFAULT 0 ,
    `user` varchar(191) NOT NULL ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `checkin-covid19`.`AdminAccounts` (
    `id` int NOT NULL  AUTO_INCREMENT,
    `passwordHash` varchar(191) NOT NULL DEFAULT '' ,
    `salt` varchar(191) NOT NULL DEFAULT '' ,
    `userName` varchar(191) NOT NULL DEFAULT '' ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `checkin-covid19`.`Token` (
    `exp` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    `iat` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    `iss` int NOT NULL ,
    `jti` varchar(191) NOT NULL  ,
    `scopes` varchar(191) NOT NULL DEFAULT '' ,
    PRIMARY KEY (`jti`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `AdminAccounts.userName` ON `checkin-covid19`.`AdminAccounts`(`userName`)

ALTER TABLE `checkin-covid19`.`CheckinLog` ADD FOREIGN KEY (`user`) REFERENCES `checkin-covid19`.`User`(`studentNumber`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `checkin-covid19`.`Token` ADD FOREIGN KEY (`iss`) REFERENCES `checkin-covid19`.`AdminAccounts`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200323103017-update-database..20200323162554-change-token-jti-from-int-to-string
--- datamodel.dml
+++ datamodel.dml
@@ -1,6 +1,6 @@
 datasource sqlite {
-  url = "***"
+  url      = env("DATABASE_URL")
   provider = "mysql"
 }
 generator client {
@@ -29,9 +29,9 @@
   tokens       Token[]
 }
 model Token {
-  jti    Int           @default(autoincrement()) @id
+  jti    String        @id
   iss    AdminAccounts @relation(references: [id])
   iat    DateTime
   exp    DateTime
   scopes String
```


